\section[toc={Neural Spectral Modeling}]{Neural Spectral Modeling Template (NSMT)}
  
\begin{emptyslide}[toc={}]{}
\vspace{-1.44em}
\myFigureRotateToBox{ADCxGather-2025-title-part2}{-90}{\twidth}{\theight}{}
%\myFigureRotateToBox{ADCxGather-2025-title-NSMT}{-90}{\twidth}{\theight}{}
\vspace{\stretch{1}}
\end{emptyslide}

\begin{slide}[\slideopts,toc={NSMT Overview}]{Neural Spectral Modeling Template (NSMT) --- Spectral-First Audio Processing}

  \vspace{-1em}

  \begin{itemize}

    \mpitem NSMT is a fork of \emph{Lightning Hydra Template Extended (LHTE)} adapted specifically for
    \textbf{audio spectrograms}

    \mpitem \emph{Key Philosophy:} All ``images'' are audio \emph{spectral representations}:
    \vspace{-0.5em}
    \begin{itemize}
      \mpitem Image \emph{height} = frequency bins
      \mpitem Image \emph{width} = time frames
      \mpitem Image \emph{channels} = alternate spectral representations:
      \begin{itemize}
        \mpitem Alternate time-frequency resolutions
        \mpitem Instantaneous-frequency / group-delay maps
        \mpitem Modulation spectra, Etc.
      \end{itemize}
    \end{itemize}

    \vspace{-0.5em}
    \mpitem \emph{Goal:} Enable \emph{small, accurate, and fast} neural networks for audio processing
    \vspace{-0.5em}
    \begin{itemize}
      \mpitem Accept inductive priors of human hearing
      \mpitem Use efficient CNN architectures with conditioning inputs
      \mpitem Avoid expensive "end-to-end" approaches that require massive data/compute
    \end{itemize}

    \vspace{-0.5em}
    \mpitem Uses only VIMH dataset format from LHTE (drops MNIST/CIFAR support)
    
    \mpitem Forked from LHTE commit \texttt{3795aad} on August 26, 2024

  \end{itemize}

\end{slide}

\begin{slide}[\slideopts,toc={VIMH Format}]{VIMH Dataset Format --- Self-Describing, Multihead}
  \vspace{-0.75em}
  \begin{itemize}
    \mpitem \textbf{VIMH} = Variable Image MultiHead format for spectrogram-like images
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem Stores H, W, C + variable-length label list per sample
      \mpitem Supports 1--255 quantized continuous parameters (0--255)
      \mpitem Single dataset auto-configures model input + heads
    \end{itemize}
    \vspace{0.25em}
    \mpitem \textbf{Label encoding:} [N, id\_1, val\_1, id\_2, val\_2, \dots]
  \end{itemize}
  \vspace{-0.5em}
  \begin{center}
    %1 Old obscure vimh example: \includegraphics[width=0.78\linewidth]{docs/png/sample_data.eps}
    %2 Better; \myFigureRotateToBox{vimh-proj}{-90}{\twidth}{0.45\theight}{}
    %3 \vspace{-4em}
    %3 \myFigureRotateToWidth{McDermottKell2018}{-90}{\twidth}{}
    %4
    %\myFigureRotateToBox{McDermottKell2018}{-90}{\twidth}{0.45\theight}{}
    % CNN diagram for NSMT (dvips-friendly)
    % Requires:
    %   \usepackage{tikz}
    %   \usetikzlibrary{positioning}

\begin{tikzpicture}[x=1mm,y=1mm, line join=round, line cap=round]

  % pseudo-3D offsets
  \def\depthx{3}
  \def\depthy{1.2}

  % Draw a 3D panel (front + right face)
  % Args: optional label, x, y, width, height, front fill color
  \newcommand{\panel}[6][]{%
    \begin{scope}[shift={(#2,#3)}]
      % front
      \filldraw[fill=#6, draw=black] (0,0) rectangle (#4,#5);
      % right face (fixed shade to avoid nested color mix errors)
      \filldraw[fill=black!20, draw=black]
        (#4,0) -- ++(\depthx,\depthy) -- ++(0,#5) -- ++(-\depthx,-\depthy) -- cycle;
      % label (optional)
      \ifx\\#1\\\else
        \node[font=\scriptsize, anchor=north] at (#4*0.5,-1.2) {#1};
      \fi
    \end{scope}%
  }

  % Spectrogram-like panel (striped front)
  % Args: optional label, x, y, width, height, front fill color
  \newcommand{\spectro}[6][]{%
    \begin{scope}[shift={(#2,#3)}]
      % front
      \filldraw[fill=#6, draw=black] (0,0) rectangle (#4,#5);
      % vertical stripes
      \foreach \xx in {2,4,6,8,10,12,14,16,18}{\draw[gray!60] (\xx,0) -- (\xx,#5);} 
      % horizontal bands
      \foreach \yy in {3,6,9,12,15,18,21,24}{\draw[gray!30] (0,\yy) -- (#4,\yy);} 
      % right face
      \filldraw[fill=black!20, draw=black]
        (#4,0) -- ++(\depthx,\depthy) -- ++(0,#5) -- ++(-\depthx,-\depthy) -- cycle;
      % label
      \ifx\\#1\\\else
        \node[font=\scriptsize, anchor=north] at (#4*0.5,-1.2) {#1};
      \fi
    \end{scope}%
  }

 

  % Positions
  \def\xin{0}  \def\yin{0}
  \def\xbA{40} \def\ybA{-2}
  \def\xbB{72} \def\ybB{0}
  \def\xbC{98} \def\ybC{6}
  \def\xbD{118}\def\ybD{10}

  % Input: 4 stacked spectrograms
  \spectro[32$\times$32$\times$1]{\xin}{\yin}{22}{26}{blue!12}
  \spectro[]{\xin-2}{\yin+1.5}{22}{26}{blue!10}
  \spectro[]{\xin-4}{\yin+3.0}{22}{26}{blue!8}
  \spectro[]{\xin-6}{\yin+4.5}{22}{26}{blue!6}
  \node[font=\scriptsize] at (\xin+7, \yin+30) {4 stacked spectrograms};

  % Connector to Conv1
  \filldraw[fill=gray!50, draw=black] (26,10) rectangle (38,16);

  % Conv1 (16 channels)
  \panel[\scriptsize Conv1: 16 ch]{\xbA}{\ybA}{18}{32}{orange!20}
  \node[font=\scriptsize, anchor=south] at (\xbA+9,\ybA+32+2) {3$\times$3, BN, ReLU};

  % Connector to Conv2
  \filldraw[fill=gray!50, draw=black] (\xbA+18+\depthx,\ybA+12+\depthy) rectangle (\xbB-2,\ybB+18);

  % Conv2 (32 channels)
  \panel[\scriptsize Conv2: 32 ch]{\xbB}{\ybB}{16}{28}{green!20}
  \node[font=\scriptsize, anchor=south] at (\xbB+8,\ybB+28+2) {3$\times$3, BN, ReLU};
  \node[font=\scriptsize, anchor=north] at (\xbB+8,\ybB-2) {MaxPool};

  % Connector to FC
  \filldraw[fill=gray!50, draw=black] (\xbB+16+\depthx,\ybB+12+\depthy) rectangle (\xbC-2,\ybC+18);

  % FC (64)
  \panel[\scriptsize FC: 64]{\xbC}{\ybC}{12}{20}{violet!20}
  \node[font=\scriptsize, anchor=south] at (\xbC+6,\ybC+20+2) {Dropout 0.3};

  % Connector to heads
  \filldraw[fill=gray!50, draw=black] (\xbC+12+\depthx,\ybC+9+\depthy) rectangle (\xbD-2,\ybD+14);

  % Regression heads (3 example heads)
  \panel[\scriptsize Head 1]{\xbD}{\ybD}{6}{14}{gray!20}
  \panel[\scriptsize Head 2]{\xbD+8}{\ybD-1}{6}{12}{gray!20}
  \panel[\scriptsize Head 3]{\xbD+16}{\ybD-2}{6}{10}{gray!20}
  \node[font=\scriptsize, anchor=south] at (\xbD+9,\ybD+16) {Regression heads};

\end{tikzpicture}
    
\end{center}
\end{slide}

\begin{slide}[\slideopts,toc={Losses}]{Distance-Aware Losses for Quantized Parameters}
  \vspace{-0.75em}
  \begin{itemize}
    \mpitem Challenge: 8-bit quantization (0--255) of continuous parameters
    \mpitem \textbf{OrdinalRegressionLoss} $\to$ continuous, distance-aware predictions
    \mpitem \textbf{QuantizedRegressionLoss} $\to$ direct regression on quantized scale
    \mpitem \textbf{WeightedCrossEntropyLoss} $\to$ classification with distance penalties
  \end{itemize}
  \vspace{-0.5em}
  \begin{center}
    \includegraphics[width=0.45\linewidth]{docs/png/vimh_loss_analysis.eps}\hspace{0.02\linewidth}
    \includegraphics[width=0.45\linewidth]{docs/png/vimh_perceptual_loss_analysis.eps}
\end{center}
\end{slide}

\begin{slide}[\slideopts,toc={Models}]{Model Families â€” Small, Accurate, and Fast}
  \vspace{-0.75em}
  \begin{itemize}
    \mpitem \textbf{CNN variants:} \texttt{cnn\_micro}, \texttt{cnn\_tiny}, \texttt{cnn\_64k}
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem Multihead heads auto-wired from VIMH metadata
      \mpitem Options: \texttt{cnn\_64k\_ordinal}, \texttt{cnn\_64k\_regression}, \texttt{cnn\_64k\_auxiliary}
    \end{itemize}
    \mpitem \textbf{ViT variants:} \texttt{vit\_micro}, \texttt{vit\_tiny} (lightweight, patch-based)
    \mpitem \textbf{Design goal:} practical models that train fast, generalize well
  \end{itemize}
  \vspace{0.25em}
  \begin{center}
    \begin{minipage}{0.95\linewidth}
      \centering
      \setlength{\fboxsep}{4pt}\fbox{\parbox{0.9\linewidth}{
          CNN: Conv $\to$ Conv $\to$ Pool $\to$ MLP $\to$ \textit{heads} (1/head) \hfill
          ViT: Patches $\to$ Transformer Blocks $\to$ \textit{heads}
      }}
    \end{minipage}
  \end{center}
\end{slide}

\begin{slide}[\slideopts,toc={Auto-Config}]{Auto-Configuration from Data to Model}
  \vspace{-0.75em}
  \begin{itemize}
    \mpitem \textbf{One dataset $\to$ complete model wiring:}
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem Read \texttt{vimh\_dataset\_info.json} $\to$ infer H, W, C, head names, ranges
      \mpitem DataModule passes shapes + parameter ranges to module
      \mpitem \texttt{VIMHLitModule} configures heads, losses, and metrics
    \end{itemize}
  \end{itemize}
  \vspace{-0.25em}
  \begin{center}
    \begin{tikzpicture}[>=stealth, node distance=1.8cm]
      \tikzstyle{box}=[draw, rounded corners, fill=blue!7, inner sep=6pt]
      \node[box] (json) {VIMH JSON (H,W,C, names, ranges)};
      \node[box, right=of json] (dm) {DataModule (transforms, loaders)};
      \node[box, right=of dm] (lit) {VIMHLitModule (auto-heads, losses)};
      \node[box, right=of lit] (train) {Trainer (callbacks, logs)};
      \draw[->] (json) -- (dm);
      \draw[->] (dm) -- (lit);
      \draw[->] (lit) -- (train);
    \end{tikzpicture}
  \end{center}
\end{slide}

\begin{slide}[\slideopts,toc={Workflow}]{Hands-On Workflow --- Datasets, Training, Diagrams}
  \vspace{-0.75em}
  \begin{itemize}
    \mpitem \textbf{Datasets}
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem \texttt{make sds} (256) \quad \texttt{make sdl} (16k) \quad \texttt{make ddr|dds|ddl}
    \end{itemize}
    \mpitem \textbf{Training}
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem \texttt{make trq} (quick sanity) \quad \texttt{make tr} (defaults)
      \mpitem \texttt{python src/train.py model=cnn\_64k\_ordinal trainer=mps}
    \end{itemize}
    \mpitem \textbf{Diagrams and Logs}
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem \texttt{make tds|td|tdsa} (model diagrams) \quad \texttt{make tensorboard}
    \end{itemize}
  \end{itemize}
  \vspace{0.25em}
  \begin{center}
    \includegraphics[width=0.7\linewidth]{docs/png/parameter\_distributions.eps}
  \end{center}
\end{slide}

\begin{slide}[\slideopts,toc={Audio Eval}]{Audio Reconstruction Evaluation --- Hear the Difference}
  \vspace{-0.75em}
  \begin{itemize}
    \mpitem \texttt{python src/audio\_reconstruction\_eval.py} (or \texttt{make ae})
    \mpitem Auto-discovers latest checkpoint, launches interactive widget
    \mpitem Compares audio synthesized from true vs predicted parameters
    \mpitem Metrics: SNR, correlation, RMSE + parameter errors
  \end{itemize}
  \vspace{0.25em}
  \begin{center}
    \setlength{\fboxsep}{6pt}\fbox{\parbox{0.88\linewidth}{
        spectrogram $\to$ model $\to$ predicted params $\to$ \textit{synth} $\to$ audio $\leftrightarrow$ compare with ground truth
    }}
  \end{center}
\end{slide}

\begin{slide}[\slideopts,toc={Moog VCF}]{Moog VCF Experiments --- Basic, Envelope, Resonance}
  \vspace{-0.75em}
  \begin{itemize}
    \mpitem \textbf{Datasets}
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem \texttt{sdmb} (4 params), \texttt{sdme} (10 params), \texttt{sdmr} (8 params)
    \end{itemize}
    \mpitem \textbf{Training}
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem \texttt{emb}, \texttt{eme} (ordinal and regression), \texttt{emr}; ViT variants via \texttt{emvit*}
    \end{itemize}
    \mpitem \textbf{Purpose:} control complexity, probe generalization across parameter spaces
  \end{itemize}
  \vspace{0.25em}
  \begin{center}
    \setlength{\fboxsep}{4pt}\fbox{\parbox{0.9\linewidth}{
        Color map: parameter sweeps across time $\to$ spectral patterns $\to$ multihead predictions
    }}
  \end{center}
\end{slide}

\begin{slide}[\slideopts,toc={Reproducibility}]{Reproducibility, Configs, and Takeaways}
  \vspace{-0.75em}
  \begin{itemize}
    \mpitem \textbf{Hydra:} \texttt{configs/train.yaml} + \texttt{experiment=example}
    \mpitem \textbf{Preflight checks:} label diversity, dataset introspection
    \mpitem \textbf{Tags + Logs:} group runs, compare configs in TensorBoard
    \mpitem \textbf{Key outcomes}
    \vspace{-0.25em}
    \begin{itemize}
      \mpitem Distance-aware losses $\to$ perceptually meaningful errors
      \mpitem VIMH auto-config $\to$ less boilerplate, fewer mistakes
      \mpitem Small models $\to$ faster iteration; competitive accuracy
    \end{itemize}
  \end{itemize}
  \vspace{0.25em}
  \begin{center}
    \includegraphics[width=0.65\linewidth]{docs/png/confusion_matrices.eps}
  \end{center}
\end{slide}
